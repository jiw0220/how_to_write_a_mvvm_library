!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(3),i=n(4),a=n(5),c=n(7);t.SegmentFault=function(){function e(){this.viewModelPool={},this.viewViewModelMap={},this.renderer=new i.Renderer,this.componentPool={}}return e.prototype.init=function(){var e=this;new a.Loader(this.componentPool).load().then(function(t){return console.log(t),e.generator=new c.ComponentGenerator(e,t),e.generator.scanComponent(document)}).then(function(){var t=new r.Scanner(e.viewModelPool),n=new o.Watcher(e);for(var i in e.viewModelPool)n.observe(e.viewModelPool[i],e.viewModelChangedHandler);e.viewViewModelMap=t.scanBindDOM(),Object.keys(e.viewViewModelMap).forEach(function(t){e.refresh(t)})})},e.prototype.registerViewModel=function(e,t){t._alias=e,window[e]=this.viewModelPool[e]=t},e.prototype.refresh=function(e){var t=this;this.viewViewModelMap[e].forEach(function(e){t.renderer.render(e)})},e.prototype.viewModelChangedHandler=function(e,t){this.refresh(e._alias)},e.prototype.registerComponent=function(e,t){this.componentPool[e]=t},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(){function e(e){this.prefix="sf-",this.viewModelPool=e}return e.prototype.scanBindDOM=function(){var e=this,t={};return this.getAllBoundElements(this.prefix).forEach(function(n){for(var o=0;o<n.attributes.length;o++){var i=n.attributes[o];if(i.nodeName.search(e.prefix)>-1){var a=i.nodeName,c=n.getAttribute(a);for(var u in e.viewModelPool)if(-1!=c.search(u+".")){var l=new r.BoundItem(e.viewModelPool[u],n,c,a);t[u]?t[u].push(l):t[u]=[l]}}}}),t},e.prototype.fuzzyFind=function(e,t){if(e&&e.attributes)for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n];if(r.nodeName.search(t)>-1)return e}return null},e.prototype.getAllBoundElements=function(e){for(var t=[],n=document.querySelectorAll("*"),r=0;r<n.length;r++){var o=n[r],i=this.fuzzyFind(o,e);i&&t.push(i)}return t},e}();t.Scanner=o},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BoundItem=function(){function BoundItem(e,t,n,r){this.interactiveDomConfig={INPUT:{text:"input",password:"input",email:"input",url:"input",tel:"input",radio:"change",checkbox:"change",color:"change",date:"change",datetime:"change","datetime-local":"change",month:"change",number:"change",range:"change",search:"change",time:"change",week:"change",button:"N/A",submit:"N/A"},SELECT:"change",TEXTAREA:"change"},this.viewModel=e,this.element=t,this.expression=n,this.attributeName=r,this.addListener(this.element,this.expression)}return BoundItem.prototype.addListener=function(element,expression){var tagName=element.tagName,eventName=this.interactiveDomConfig[tagName];if(eventName){if("object"==typeof eventName){var type=element.getAttribute("type");eventName=eventName[type]}element.addEventListener(eventName,function(e){var newValue=element.value,cmd=expression+'= "'+newValue+'"';try{eval(cmd)}catch(e){console.error(e)}})}},BoundItem}();exports.BoundItem=BoundItem},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.sf=e}return e.prototype.observe=function(e,t){var n=this.sf;for(var r in e){var o=e[r];!function(r,o){"_alias"!==r&&Object.defineProperty(e,r,{get:function(){return o},set:function(i){o=i,console.log("do something after set a new value"),t.call(n,e,r)}})}(r,o)}},e}();t.Watcher=r},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Renderer=function(){function Renderer(){}return Renderer.prototype.render=function(e){var t=this.getValue(e.viewModel,e.expression),n=e.attributeName.split("-")[1];"innertext"===n.toLowerCase()&&(n="innerText"),e.element[n]=t},Renderer.prototype.getValue=function(viewModel,expression){return function(){var alias=viewModel._alias,tempScope={};tempScope[alias]=viewModel;try{var pattern=new RegExp("\\b"+alias+"\\b","gm");expression=expression.replace(pattern,"tempScope."+alias);var result=eval(expression);return tempScope=null,result}catch(e){throw e}}()},Renderer}();exports.Renderer=Renderer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=function(){function e(e){this.componentDefinitionPool={},this.componentPool=e}return e.prototype.load=function(){var e=[];for(var t in this.componentPool)e.push({name:t,path:this.componentPool[t]});return this.doAsyncSeries(e).then(function(e){return e})},e.prototype.doAsyncSeries=function(e){var t=this;return e.reduce(function(e,n){return e.then(function(e){return fetch(n.path).then(function(e){return e.text().then(function(e){var r=t.getComponentDefinition(n.name,e);return t.componentDefinitionPool[n.name]=r,t.componentDefinitionPool})})})},new Promise(function(e,t){e()}))},e.prototype.getComponentDefinition=function(e,t){var n=document.createElement("div");n.innerHTML=t;var o=n.querySelectorAll("template")[0]&&n.querySelectorAll("template")[0].innerHTML,i=n.querySelectorAll("script")[0]&&n.querySelectorAll("script")[0].innerHTML,a=n.querySelectorAll("style")[0]&&n.querySelectorAll("style")[0].innerHTML;return new r.ComponentDefinition(e,a,o,i)},e}();t.Loader=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){this.tagName=e,this.style=t,this.template=n,this.script=r}return e.prototype.generateRealComponent=function(){},e}();t.ComponentDefinition=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,c)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],i=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,a,c,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.componentDefinitionPool=t,this.sf=e}return e.prototype.scanComponent=function(e){return r(this,void 0,void 0,function(){var t,n,r,i;return o(this,function(o){switch(o.label){case 0:return(t=this.componentDefinitionPool[e.localName])?(n=e.attributes,[2,this.generate(e,t,n)]):[3,1];case 1:if(!(e.children&&e.children.length>0))return[3,6];r=0,o.label=2;case 2:return r<e.children.length?(i=e.children[r],[4,this.scanComponent(i)]):[3,5];case 3:o.sent(),o.label=4;case 4:return r++,[3,2];case 5:case 6:return[2,e]}})})},e.prototype.generate=function(e,t,n){return r(this,void 0,void 0,function(){var r,i,a,c,u,l,s,p,f;return o(this,function(o){switch(o.label){case 0:if(this.dealWithShadowStyle(t),r="vm_"+Math.floor(1e4*Math.random()).toString(),i=t.template,i=i.replace(new RegExp("this","gm"),r),a=document.createElement("div"),a.insertAdjacentHTML("afterBegin",i),a.children.length>1&&(i=a.outerHTML),e.insertAdjacentHTML("beforeBegin",i),c=e.previousElementSibling,c.classList.add(e.localName),t.script)u=new Function(t.script),this.sf.registerViewModel(r,new u.prototype.constructor);else for(l=0;l<n.length;l++)s=n[l],c.setAttribute(s.nodeName,s.nodeValue);if(e.parentNode.removeChild(e),!(c.children&&c.children.length>0))return[3,5];p=0,o.label=1;case 1:return p<c.children.length?(f=c.children[p],[4,this.scanComponent(f)]):[3,4];case 2:o.sent(),o.label=3;case 3:return p++,[3,1];case 4:case 5:return[2,c]}})})},e.prototype.dealWithShadowStyle=function(e){var t=e.style,n=e.tagName,r=document.getElementsByTagName("HEAD")[0],o=document.createElement("style");o.type="text/css";var i=t.split("}"),a=[];i.forEach(function(e,t){var n=e.replace(/^\s*/,"");n&&a.push(n)}),t=a.join("}\n."+n+" "),t="."+n+" "+t+"}",o.innerHTML=t,r.appendChild(o)},e}();t.ComponentGenerator=i}])});
//# sourceMappingURL=sf.js.map