!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),r=n(3),i=n(4),a=n(5);t.SegmentFault=function(){function e(){this.viewModelPool={},this.viewViewModelMap={},this.renderer=new i.Renderer,this.componentPool={}}return e.prototype.init=function(){var e=this;new a.Loader(this.componentPool).load().then(function(e){console.log(e)});var t=new o.Scanner(this.viewModelPool),n=new r.Watcher(this);for(var i in this.viewModelPool)n.observe(this.viewModelPool[i],this.viewModelChangedHandler);this.viewViewModelMap=t.scanBindDOM(),Object.keys(this.viewViewModelMap).forEach(function(t){e.refresh(t)})},e.prototype.registerViewModel=function(e,t){t._alias=e,window[e]=this.viewModelPool[e]=t},e.prototype.refresh=function(e){var t=this;this.viewViewModelMap[e].forEach(function(e){t.renderer.render(e)})},e.prototype.viewModelChangedHandler=function(e,t){this.refresh(e._alias)},e.prototype.registerComponent=function(e,t){this.componentPool[e]=t},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=function(){function e(e){this.prefix="sf-",this.viewModelPool=e}return e.prototype.scanBindDOM=function(){var e=this,t={};return this.getAllBoundElements(this.prefix).forEach(function(n){for(var r=0;r<n.attributes.length;r++){var i=n.attributes[r];if(i.nodeName.search(e.prefix)>-1){var a=i.nodeName,u=n.getAttribute(a);for(var s in e.viewModelPool)if(-1!=u.search(s+".")){var c=new o.BoundItem(e.viewModelPool[s],n,u,a);t[s]?t[s].push(c):t[s]=[c]}}}}),t},e.prototype.fuzzyFind=function(e,t){if(e&&e.attributes)for(var n=0;n<e.attributes.length;n++){var o=e.attributes[n];if(o.nodeName.search(t)>-1)return e}return null},e.prototype.getAllBoundElements=function(e){for(var t=[],n=document.querySelectorAll("*"),o=0;o<n.length;o++){var r=n[o],i=this.fuzzyFind(r,e);i&&t.push(i)}return t},e}();t.Scanner=r},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BoundItem=function(){function BoundItem(e,t,n,o){this.interactiveDomConfig={INPUT:{text:"input",password:"input",email:"input",url:"input",tel:"input",radio:"change",checkbox:"change",color:"change",date:"change",datetime:"change","datetime-local":"change",month:"change",number:"change",range:"change",search:"change",time:"change",week:"change",button:"N/A",submit:"N/A"},SELECT:"change",TEXTAREA:"change"},this.viewModel=e,this.element=t,this.expression=n,this.attributeName=o,this.addListener(this.element,this.expression)}return BoundItem.prototype.addListener=function(element,expression){var tagName=element.tagName,eventName=this.interactiveDomConfig[tagName];if(eventName){if("object"==typeof eventName){var type=element.getAttribute("type");eventName=eventName[type]}element.addEventListener(eventName,function(e){var newValue=element.value,cmd=expression+'= "'+newValue+'"';try{eval(cmd)}catch(e){console.error(e)}})}},BoundItem}();exports.BoundItem=BoundItem},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.sf=e}return e.prototype.observe=function(e,t){var n=this.sf;for(var o in e){var r=e[o];!function(o,r){"_alias"!==o&&Object.defineProperty(e,o,{get:function(){return r},set:function(i){r=i,console.log("do something after set a new value"),t.call(n,e,o)}})}(o,r)}},e}();t.Watcher=o},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Renderer=function(){function Renderer(){}return Renderer.prototype.render=function(e){var t=this.getValue(e.viewModel,e.expression),n=e.attributeName.split("-")[1];"innertext"===n.toLowerCase()&&(n="innerText"),e.element[n]=t},Renderer.prototype.getValue=function(viewModel,expression){return function(){var alias=viewModel._alias,tempScope={};tempScope[alias]=viewModel;try{var pattern=new RegExp("\\b"+alias+"\\b","gm");expression=expression.replace(pattern,"tempScope."+alias);var result=eval(expression);return tempScope=null,result}catch(e){throw e}}()},Renderer}();exports.Renderer=Renderer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),r=function(){function e(e){this.componentDefinitionPool={},this.componentPool=e}return e.prototype.load=function(){var e=[];for(var t in this.componentPool)e.push({name:t,path:this.componentPool[t]});return this.doAsyncSeries(e).then(function(e){return e})},e.prototype.doAsyncSeries=function(e){var t=this;return e.reduce(function(e,n){return e.then(function(e){return fetch(n.path).then(function(e){return e.text().then(function(e){var o=t.getComponentConfiguration(n.name,e);return t.componentDefinitionPool[n.name]=o,t.componentDefinitionPool})})})},new Promise(function(e,t){e()}))},e.prototype.getComponentConfiguration=function(e,t){var n=document.createElement("div");n.innerHTML=t;var r=n.querySelectorAll("body")[0],i=n.querySelectorAll("script")[0]&&n.querySelectorAll("script")[0].innerHTML,a=n.querySelectorAll("style")[0]&&n.querySelectorAll("style")[0].innerHTML;return new o.ComponentModel(e,a,r,i)},e}();t.Loader=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,n,o){this.tagName=e,this.style=t,this.body=n,this.script=o}return e}();t.ComponentModel=o}])});
//# sourceMappingURL=sf.js.map