{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///sf.js","webpack:///webpack/bootstrap f253fe01584f2f7c6efe","webpack:///./lib/SegmentFault.ts","webpack:///./lib/Scanner.ts","webpack:///./lib/BoundItem.ts","webpack:///./lib/Watcher.ts","webpack:///./lib/Renderer.ts","webpack:///./lib/component/Loader.ts","webpack:///./lib/component/ComponentDefinition.ts","webpack:///./lib/component/ComponentGenerator.ts"],"names":["root","factory","exports","module","define","amd","a","i","this","modules","__webpack_require__","moduleId","installedModules","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","value","Scanner_1","Watcher_1","Renderer_1","Loader_1","ComponentGenerator_1","SegmentFault","viewModelPool","viewViewModelMap","renderer","Renderer","componentPool","init","_this","Loader","load","then","componentDefinitionPool","console","log","generator","ComponentGenerator","scanComponent","document","scanner","Scanner","watcher","Watcher","key","observe","viewModelChangedHandler","scanBindDOM","keys","forEach","alias","refresh","registerViewModel","viewModel","window","boundItem","render","prop","_alias","registerComponent","tagName","path","BoundItem_1","prefix","boundMap","getAllBoundElements","element","attributes","length","attr","nodeName","search","attributeName","expression","getAttribute","BoundItem","push","fuzzyFind","text","elements","allChildren","querySelectorAll","child","matchElement","interactiveDomConfig","INPUT","password","email","url","tel","radio","checkbox","color","date","datetime","datetime-local","month","number","range","time","week","button","submit","SELECT","TEXTAREA","addListener","eventName","type","addEventListener","e","newValue","cmd","eval","error","sf","callback","host","defaultValue","k","dv","set","getValue","attribute","split","toLowerCase","tempScope","pattern","RegExp","replace","result","ComponentDefinition_1","compArray","doAsyncSeries","componentArray","reduce","promise","comp","fetch","response","definition","def","getComponentDefinition","Promise","resolve","reject","htmlString","tempDom","createElement","innerHTML","template","script","style","ComponentDefinition","generateRealComponent","__awaiter","thisArg","_arguments","P","fulfilled","step","next","rejected","done","apply","__generator","body","verb","v","op","f","TypeError","_","y","t","label","ops","pop","trys","g","sent","throw","return","Symbol","iterator","compDef","attrs","_a","localName","generate","children","tagElement","randomAlias","tempFragment","htmlDom","ViewModelClass","j","dealWithShadowStyle","Math","floor","random","toString","insertAdjacentHTML","outerHTML","previousElementSibling","classList","add","Function","constructor","setAttribute","nodeValue","parentNode","removeChild","stylesheet","head","getElementsByTagName","styleArray","newArray","index","join","appendChild"],"mappings":"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","file":"sf.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Scanner_1 = __webpack_require__(1);\r\nvar Watcher_1 = __webpack_require__(3);\r\nvar Renderer_1 = __webpack_require__(4);\r\nvar Loader_1 = __webpack_require__(5);\r\nvar ComponentGenerator_1 = __webpack_require__(7);\r\nexports.SegmentFault = (function () {\r\n    function SegmentFault() {\r\n        this.viewModelPool = {};\r\n        this.viewViewModelMap = {};\r\n        this.renderer = new Renderer_1.Renderer();\r\n        //web component相关功能的扩展 从此行开始\r\n        this.componentPool = {};\r\n    }\r\n    SegmentFault.prototype.init = function () {\r\n        //web component相关功能的扩展 从此行开始\r\n        //Hi Scanner,Watch你们俩先别急着监视，扫描,先让我把Componont的定义load进来。\r\n        var _this = this;\r\n        var loader = new Loader_1.Loader(this.componentPool);\r\n        loader.load().then(function (componentDefinitionPool) {\r\n            console.log(componentDefinitionPool);\r\n            _this.generator = new ComponentGenerator_1.ComponentGenerator(_this, componentDefinitionPool);\r\n            return _this.generator.scanComponent(document);\r\n        }).then(function () {\r\n            var scanner = new Scanner_1.Scanner(_this.viewModelPool);\r\n            var watcher = new Watcher_1.Watcher(_this);\r\n            for (var key in _this.viewModelPool) {\r\n                watcher.observe(_this.viewModelPool[key], _this.viewModelChangedHandler);\r\n            }\r\n            _this.viewViewModelMap = scanner.scanBindDOM();\r\n            Object.keys(_this.viewViewModelMap).forEach(function (alias) {\r\n                _this.refresh(alias);\r\n            });\r\n        });\r\n    };\r\n    ;\r\n    SegmentFault.prototype.registerViewModel = function (alias, viewModel) {\r\n        viewModel[\"_alias\"] = alias;\r\n        window[alias] = this.viewModelPool[alias] = viewModel;\r\n    };\r\n    ;\r\n    SegmentFault.prototype.refresh = function (alias) {\r\n        var _this = this;\r\n        var boundItems = this.viewViewModelMap[alias];\r\n        boundItems.forEach(function (boundItem) {\r\n            _this.renderer.render(boundItem);\r\n        });\r\n    };\r\n    SegmentFault.prototype.viewModelChangedHandler = function (viewModel, prop) {\r\n        this.refresh(viewModel._alias);\r\n    };\r\n    SegmentFault.prototype.registerComponent = function (tagName, path) {\r\n        this.componentPool[tagName] = path;\r\n    };\r\n    return SegmentFault;\r\n}());\r\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar BoundItem_1 = __webpack_require__(2);\r\nvar Scanner = (function () {\r\n    function Scanner(viewModelPool) {\r\n        this.prefix = \"sf-\";\r\n        this.viewModelPool = viewModelPool;\r\n    }\r\n    Scanner.prototype.scanBindDOM = function () {\r\n        var _this = this;\r\n        var boundMap = {};\r\n        var boundElements = this.getAllBoundElements(this.prefix);\r\n        boundElements.forEach(function (element) {\r\n            for (var i = 0; i < element.attributes.length; i++) {\r\n                var attr = element.attributes[i];\r\n                if (attr.nodeName.search(_this.prefix) > -1) {\r\n                    var attributeName = attr.nodeName;\r\n                    var expression = element.getAttribute(attributeName);\r\n                    for (var alias in _this.viewModelPool) {\r\n                        if (expression.search(alias + \".\") != -1) {\r\n                            var boundItem = new BoundItem_1.BoundItem(_this.viewModelPool[alias], element, expression, attributeName);\r\n                            if (!boundMap[alias]) {\r\n                                boundMap[alias] = [boundItem];\r\n                            }\r\n                            else {\r\n                                boundMap[alias].push(boundItem);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return boundMap;\r\n    };\r\n    Scanner.prototype.fuzzyFind = function (element, text) {\r\n        if (element && element.attributes) {\r\n            for (var i = 0; i < element.attributes.length; i++) {\r\n                var attr = element.attributes[i];\r\n                if (attr.nodeName.search(text) > -1) {\r\n                    return element;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Scanner.prototype.getAllBoundElements = function (prefix) {\r\n        var elements = [];\r\n        var allChildren = document.querySelectorAll(\"*\");\r\n        for (var i = 0; i < allChildren.length; i++) {\r\n            var child = allChildren[i];\r\n            var matchElement = this.fuzzyFind(child, prefix);\r\n            if (matchElement) {\r\n                elements.push(matchElement);\r\n            }\r\n        }\r\n        return elements;\r\n    };\r\n    return Scanner;\r\n}());\r\nexports.Scanner = Scanner;\r\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar BoundItem = (function () {\r\n    function BoundItem(viewModel, element, expression, attributeName) {\r\n        this.interactiveDomConfig = {\r\n            \"INPUT\": {\r\n                \"text\": \"input\",\r\n                \"password\": \"input\",\r\n                \"email\": \"input\",\r\n                \"url\": \"input\",\r\n                \"tel\": \"input\",\r\n                \"radio\": \"change\",\r\n                \"checkbox\": \"change\",\r\n                \"color\": \"change\",\r\n                \"date\": \"change\",\r\n                \"datetime\": \"change\",\r\n                \"datetime-local\": \"change\",\r\n                \"month\": \"change\",\r\n                \"number\": \"change\",\r\n                \"range\": \"change\",\r\n                \"search\": \"change\",\r\n                \"time\": \"change\",\r\n                \"week\": \"change\",\r\n                \"button\": \"N/A\",\r\n                \"submit\": \"N/A\"\r\n            },\r\n            \"SELECT\": \"change\",\r\n            \"TEXTAREA\": \"change\"\r\n        };\r\n        this.viewModel = viewModel;\r\n        this.element = element;\r\n        this.expression = expression;\r\n        this.attributeName = attributeName;\r\n        this.addListener(this.element, this.expression);\r\n    }\r\n    BoundItem.prototype.addListener = function (element, expression) {\r\n        var tagName = element.tagName;\r\n        var eventName = this.interactiveDomConfig[tagName];\r\n        if (!eventName) {\r\n            return;\r\n        }\r\n        if (typeof eventName === \"object\") {\r\n            var type = element.getAttribute(\"type\");\r\n            eventName = eventName[type];\r\n        }\r\n        element.addEventListener(eventName, function (e) {\r\n            var newValue = element.value;\r\n            var cmd = expression + \"= \\\"\" + newValue + \"\\\"\";\r\n            try {\r\n                eval(cmd);\r\n            }\r\n            catch (e) {\r\n                console.error(e);\r\n            }\r\n        });\r\n    };\r\n    return BoundItem;\r\n}());\r\nexports.BoundItem = BoundItem;\r\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Watcher = (function () {\r\n    function Watcher(sf) {\r\n        this.sf = sf;\r\n    }\r\n    Watcher.prototype.observe = function (viewModel, callback) {\r\n        var host = this.sf;\r\n        for (var key in viewModel) {\r\n            var defaultValue = viewModel[key];\r\n            (function (k, dv) {\r\n                if (k !== \"_alias\") {\r\n                    Object.defineProperty(viewModel, k, {\r\n                        get: function () {\r\n                            return dv;\r\n                        },\r\n                        set: function (value) {\r\n                            dv = value;\r\n                            console.log(\"do something after set a new value\");\r\n                            callback.call(host, viewModel, k);\r\n                        }\r\n                    });\r\n                }\r\n            })(key, defaultValue);\r\n        }\r\n    };\r\n    return Watcher;\r\n}());\r\nexports.Watcher = Watcher;\r\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Renderer = (function () {\r\n    function Renderer() {\r\n    }\r\n    Renderer.prototype.render = function (boundItem) {\r\n        var value = this.getValue(boundItem.viewModel, boundItem.expression);\r\n        var attribute = boundItem.attributeName.split('-')[1];\r\n        if (attribute.toLowerCase() === \"innertext\") {\r\n            attribute = \"innerText\";\r\n        }\r\n        boundItem.element[attribute] = value;\r\n    };\r\n    ;\r\n    Renderer.prototype.getValue = function (viewModel, expression) {\r\n        return (function () {\r\n            var alias = viewModel._alias;\r\n            var tempScope = {};\r\n            tempScope[alias] = viewModel;\r\n            try {\r\n                var pattern = new RegExp(\"\\\\b\" + alias + \"\\\\b\", \"gm\");\r\n                expression = expression.replace(pattern, \"tempScope.\" + alias);\r\n                var result = eval(expression);\r\n                tempScope = null;\r\n                return result;\r\n            }\r\n            catch (e) {\r\n                throw e;\r\n            }\r\n        })();\r\n    };\r\n    return Renderer;\r\n}());\r\nexports.Renderer = Renderer;\r\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ComponentDefinition_1 = __webpack_require__(6);\r\nvar Loader = (function () {\r\n    function Loader(componentPool) {\r\n        this.componentDefinitionPool = {};\r\n        this.componentPool = componentPool;\r\n    }\r\n    Loader.prototype.load = function () {\r\n        var compArray = [];\r\n        for (var tagName in this.componentPool) {\r\n            compArray.push({ name: tagName, path: this.componentPool[tagName] });\r\n        }\r\n        return this.doAsyncSeries(compArray).then(function (result) {\r\n            return result;\r\n        });\r\n    };\r\n    Loader.prototype.doAsyncSeries = function (componentArray) {\r\n        var _this = this;\r\n        return componentArray.reduce(function (promise, comp) {\r\n            return promise.then(function (result) {\r\n                return fetch(comp.path).then(function (response) {\r\n                    return response.text().then(function (definition) {\r\n                        var def = _this.getComponentDefinition(comp.name, definition);\r\n                        _this.componentDefinitionPool[comp.name] = def;\r\n                        return _this.componentDefinitionPool;\r\n                    });\r\n                });\r\n            });\r\n        }, new Promise(function (resolve, reject) {\r\n            resolve();\r\n        }));\r\n    };\r\n    Loader.prototype.getComponentDefinition = function (tagName, htmlString) {\r\n        var tempDom = document.createElement(\"div\");\r\n        tempDom.innerHTML = htmlString;\r\n        var template = tempDom.querySelectorAll(\"template\")[0] && tempDom.querySelectorAll(\"template\")[0].innerHTML;\r\n        var script = tempDom.querySelectorAll(\"script\")[0] && tempDom.querySelectorAll(\"script\")[0].innerHTML;\r\n        var style = tempDom.querySelectorAll(\"style\")[0] && tempDom.querySelectorAll(\"style\")[0].innerHTML;\r\n        return new ComponentDefinition_1.ComponentDefinition(tagName, style, template, script);\r\n    };\r\n    return Loader;\r\n}());\r\nexports.Loader = Loader;\r\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ComponentDefinition = (function () {\r\n    function ComponentDefinition(tagName, style, template, script) {\r\n        this.tagName = tagName;\r\n        this.style = style;\r\n        this.template = template;\r\n        this.script = script;\r\n    }\r\n    ComponentDefinition.prototype.generateRealComponent = function () {\r\n    };\r\n    return ComponentDefinition;\r\n}());\r\nexports.ComponentDefinition = ComponentDefinition;\r\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ComponentGenerator = (function () {\r\n    function ComponentGenerator(sf, componentDefinitionPool) {\r\n        this.componentDefinitionPool = componentDefinitionPool;\r\n        this.sf = sf;\r\n    }\r\n    ComponentGenerator.prototype.scanComponent = function (element) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var compDef, attrs, i, child;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        compDef = this.componentDefinitionPool[element.localName];\r\n                        if (!compDef) return [3 /*break*/, 1];\r\n                        attrs = element.attributes;\r\n                        return [2 /*return*/, this.generate(element, compDef, attrs)];\r\n                    case 1:\r\n                        if (!(element.children && element.children.length > 0)) return [3 /*break*/, 6];\r\n                        i = 0;\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (!(i < element.children.length)) return [3 /*break*/, 5];\r\n                        child = element.children[i];\r\n                        return [4 /*yield*/, this.scanComponent(child)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        i++;\r\n                        return [3 /*break*/, 2];\r\n                    case 5: return [2 /*return*/, element];\r\n                    case 6: return [2 /*return*/, element];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ComponentGenerator.prototype.generate = function (tagElement, compDef, attrs) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var randomAlias, template, tempFragment, htmlDom, ViewModelClass, i, attr, j, child;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.dealWithShadowStyle(compDef);\r\n                        randomAlias = 'vm_' + Math.floor(10000 * Math.random()).toString();\r\n                        template = compDef.template;\r\n                        template = template.replace(new RegExp('this', 'gm'), randomAlias);\r\n                        tempFragment = document.createElement('div');\r\n                        tempFragment.insertAdjacentHTML('afterBegin', template);\r\n                        if (tempFragment.children.length > 1) {\r\n                            template = tempFragment.outerHTML;\r\n                        }\r\n                        tagElement.insertAdjacentHTML('beforeBegin', template);\r\n                        htmlDom = tagElement.previousElementSibling;\r\n                        htmlDom.classList.add(tagElement.localName);\r\n                        if (compDef.script) {\r\n                            ViewModelClass = new Function(compDef.script);\r\n                            this.sf.registerViewModel(randomAlias, new ViewModelClass.prototype.constructor());\r\n                        }\r\n                        else {\r\n                            for (i = 0; i < attrs.length; i++) {\r\n                                attr = attrs[i];\r\n                                htmlDom.setAttribute(attr.nodeName, attr.nodeValue);\r\n                            }\r\n                        }\r\n                        tagElement.parentNode.removeChild(tagElement);\r\n                        if (!(htmlDom.children && htmlDom.children.length > 0)) return [3 /*break*/, 5];\r\n                        j = 0;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(j < htmlDom.children.length)) return [3 /*break*/, 4];\r\n                        child = htmlDom.children[j];\r\n                        return [4 /*yield*/, this.scanComponent(child)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        j++;\r\n                        return [3 /*break*/, 1];\r\n                    case 4: return [2 /*return*/, htmlDom];\r\n                    case 5: return [2 /*return*/, htmlDom];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ComponentGenerator.prototype.dealWithShadowStyle = function (compDef) {\r\n        var stylesheet = compDef.style;\r\n        var tagName = compDef.tagName;\r\n        var head = document.getElementsByTagName('HEAD')[0];\r\n        var style = document.createElement('style');\r\n        style.type = 'text/css';\r\n        var styleArray = stylesheet.split(\"}\");\r\n        var newArray = [];\r\n        styleArray.forEach(function (value, index) {\r\n            var newValue = value.replace(/^\\s*/, \"\");\r\n            if (newValue) {\r\n                newArray.push(newValue);\r\n            }\r\n        });\r\n        stylesheet = newArray.join(\"}\\n\" + \".\" + tagName + \" \");\r\n        stylesheet = \".\" + tagName + \" \" + stylesheet + \"}\";\r\n        style.innerHTML = stylesheet;\r\n        head.appendChild(style);\r\n    };\r\n    return ComponentGenerator;\r\n}());\r\nexports.ComponentGenerator = ComponentGenerator;\r\n\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// sf.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f253fe01584f2f7c6efe","import {Scanner} from \"./Scanner\";\nimport {Watcher} from \"./Watcher\";\nimport {Renderer} from \"./Renderer\";\nimport {Loader} from \"./component/Loader\";\nimport {ComponentGenerator} from \"./component/ComponentGenerator\";\nexport let SegmentFault = class SegmentFault {\n    private viewModelPool = {};\n    private viewViewModelMap = {};\n    private renderer = new Renderer();\n    private generator:ComponentGenerator;\n    public init() {\n        //web component相关功能的扩展 从此行开始\n        //Hi Scanner,Watch你们俩先别急着监视，扫描,先让我把Componont的定义load进来。\n\n        let loader = new Loader(this.componentPool);\n        loader.load().then( componentDefinitionPool =>{\n            console.log(componentDefinitionPool);\n\n            this.generator = new ComponentGenerator(this,componentDefinitionPool);\n            return this.generator.scanComponent(document);\n        }).then(()=>{\n            let scanner = new Scanner(this.viewModelPool);\n            let watcher = new Watcher(this);\n            for (let key in this.viewModelPool) {\n                watcher.observe(this.viewModelPool[key],this.viewModelChangedHandler);\n            }\n            this.viewViewModelMap = scanner.scanBindDOM();\n            Object.keys(this.viewViewModelMap).forEach(alias=>{\n                this.refresh(alias);\n            }); \n        });\n    };\n    public registerViewModel(alias:string, viewModel:object) {\n        viewModel[\"_alias\"] = alias;\n        window[alias] = this.viewModelPool[alias] = viewModel;\n    };\n    public refresh(alias:string){\n        let boundItems = this.viewViewModelMap[alias];\n        boundItems.forEach(boundItem => {\n            this.renderer.render(boundItem);\n        });\n    }\n    private viewModelChangedHandler(viewModel,prop) {\n        this.refresh(viewModel._alias);\n    }\n\n    //web component相关功能的扩展 从此行开始\n    private componentPool = {};\n    public registerComponent(tagName,path){\n        this.componentPool[tagName] = path;\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/SegmentFault.ts","import { BoundItem } from \"./BoundItem\";\nexport class Scanner {\n    private prefix = \"sf-\";\n    private viewModelPool;\n\n    constructor(viewModelPool) {\n        this.viewModelPool = viewModelPool;\n    }\n    public scanBindDOM() :object{\n        let boundMap = {};\n        \n        let boundElements = this.getAllBoundElements(this.prefix);\n        boundElements.forEach(element => {\n           for (let i = 0; i < element.attributes.length; i++) {\n                let attr = element.attributes[i];\n                if (attr.nodeName.search(this.prefix) > -1) {\n                    let attributeName = attr.nodeName;\n                    let expression = element.getAttribute(attributeName);\n                    for (let alias in this.viewModelPool) {\n                        if (expression.search(alias + \".\") != -1) {\n                            let boundItem = new BoundItem(this.viewModelPool[alias], element, expression,attributeName);\n                            if (!boundMap[alias]) {\n                                boundMap[alias] = [boundItem];\n                            } else {\n                                boundMap[alias].push(boundItem);\n                            }\n                        }\n                    }\n                }\n            }\n        });  \n        return boundMap;\n    }\n\n    private fuzzyFind(element:HTMLElement,text:string):HTMLElement {\n        if (element && element.attributes) {\n            for (let i = 0; i < element.attributes.length; i++) {\n                let attr = element.attributes[i];\n                if (attr.nodeName.search(text) > -1) {\n                    return element;\n                }\n            }\n        }\n        return null;\n    }\n     private getAllBoundElements(prefix): Array<HTMLElement> {\n        let elements = [];\n        let allChildren = document.querySelectorAll(\"*\");\n        for (let i = 0; i < allChildren.length; i++) {\n            let child: HTMLElement = allChildren[i] as HTMLElement;\n            let matchElement = this.fuzzyFind(child, prefix);\n            if (matchElement) {\n                elements.push(matchElement);\n            }\n        }\n        return elements;\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/Scanner.ts","export class BoundItem {\n    public viewModel: object;\n    public element: Element;\n    public expression: string;\n    public attributeName: string;\n    private interactiveDomConfig = {\n        \"INPUT\":{\n            \"text\":\"input\",\n            \"password\":\"input\",\n            \"email\":\"input\",\n            \"url\":\"input\",\n            \"tel\":\"input\",\n            \"radio\":\"change\",\n            \"checkbox\":\"change\",\n            \"color\":\"change\",\n            \"date\":\"change\",\n            \"datetime\":\"change\",\n            \"datetime-local\":\"change\",\n            \"month\":\"change\",\n            \"number\":\"change\",\n            \"range\":\"change\",\n            \"search\":\"change\",\n            \"time\":\"change\",\n            \"week\":\"change\",\n            \"button\":\"N/A\",\n            \"submit\":\"N/A\"\n        },\n        \"SELECT\":\"change\",\n        \"TEXTAREA\":\"change\"\n    }\n    constructor(viewModel: object, element: Element, expression: string, attributeName: string) {\n        this.viewModel = viewModel;\n        this.element = element;\n        this.expression = expression;\n        this.attributeName = attributeName;\n        this.addListener(this.element,this.expression);\n    }\n\n    private addListener(element,expression){\n        let tagName = element.tagName;\n        let eventName = this.interactiveDomConfig[tagName];\n        if(!eventName){\n            return;\n        }\n        if(typeof eventName === \"object\"){\n            let type = element.getAttribute(\"type\");\n            eventName = eventName[type];\n        }\n        element.addEventListener(eventName, (e)=> {\n            let newValue = (element as HTMLInputElement).value;\n            let cmd = expression + \"= \\\"\" + newValue + \"\\\"\";\n            try{\n                eval(cmd);\n            }catch(e){\n                console.error(e);\n            }\n        });\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/BoundItem.ts","export class Watcher {\n    private sf;\n    constructor(sf) {\n        this.sf = sf;\n    }\n    public observe(viewModel, callback) {\n        let host = this.sf;\n        for (var key in viewModel) {\n            var defaultValue = viewModel[key];\n            (function (k, dv) {\n                if (k !== \"_alias\") {\n                    Object.defineProperty(viewModel, k, {\n                        get: function () {\n                            return dv;\n                        },\n                        set: function (value) {\n                            dv = value;\n                            console.log(\"do something after set a new value\");\n                            callback.call(host, viewModel, k);\n                        }\n                    });\n                }\n            })(key, defaultValue);\n        }\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/Watcher.ts","import {BoundItem} from \"./BoundItem\";\nexport class Renderer{\n    public render(boundItem:BoundItem) {\n        var value = this.getValue(boundItem.viewModel, boundItem.expression);\n        var attribute = boundItem.attributeName.split('-')[1];\n\n        if (attribute.toLowerCase() === \"innertext\") {\n            attribute = \"innerText\";\n        }\n        boundItem.element[attribute] = value;\n    };\n    private getValue(viewModel, expression) {\n        return (function () {\n            var alias = viewModel._alias;\n            var tempScope = {};\n            tempScope[alias] = viewModel;\n            try {\n                var pattern = new RegExp(\"\\\\b\" + alias + \"\\\\b\", \"gm\");\n                expression = expression.replace(pattern, \"tempScope.\" + alias);\n                var result = eval(expression);\n                tempScope = null;\n                return result;\n            } catch (e) {\n                throw e;\n            }\n        })();\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/Renderer.ts","import {ComponentDefinition} from \"./ComponentDefinition\";\nexport class Loader {\n    private componentPool;\n    private componentDefinitionPool = {};\n    constructor(componentPool) {\n        this.componentPool = componentPool;\n    }\n\n    public load(): Promise<any> {\n        let compArray = [];\n        for (var tagName in this.componentPool) {\n            compArray.push({ name: tagName, path: this.componentPool[tagName] });\n        }\n        return this.doAsyncSeries(compArray).then(result=>{\n            return result;\n        });\n    }\n\n    private doAsyncSeries(componentArray): Promise<any> {\n        return componentArray.reduce( (promise, comp) =>{\n            return promise.then( (result) => {\n                return fetch(comp.path).then((response) => {\n                    return response.text().then(definition => {\n                        let def = this.getComponentDefinition(comp.name,definition);\n                        this.componentDefinitionPool[comp.name] = def;\n                        return this.componentDefinitionPool;\n                    });\n                });\n            });\n        }, new Promise<void>((resolve, reject) => {\n            resolve();\n        }));\n    }\n\n    private getComponentDefinition(tagName:string, htmlString: string): ComponentDefinition {\n        let tempDom: HTMLElement = document.createElement(\"div\");\n        tempDom.innerHTML = htmlString;\n        let template: string = tempDom.querySelectorAll(\"template\")[0] && tempDom.querySelectorAll(\"template\")[0].innerHTML;\n        let script: string = tempDom.querySelectorAll(\"script\")[0] && tempDom.querySelectorAll(\"script\")[0].innerHTML;\n        let style: string = tempDom.querySelectorAll( \"style\")[0] && tempDom.querySelectorAll( \"style\")[0].innerHTML;\n\n        return new ComponentDefinition(tagName,style,template,script);\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/component/Loader.ts","export class ComponentDefinition{\n    public tagName;\n    public style;\n    public template;\n    public script; \n    constructor(tagName,style,template,script){\n        this.tagName = tagName;\n        this.style = style;\n        this.template = template;\n        this.script = script;\n    }\n\n    public generateRealComponent(){\n        \n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/component/ComponentDefinition.ts","import { ComponentDefinition } from \"./ComponentDefinition\";\nexport class ComponentGenerator {\n    private sf;\n    private componentDefinitionPool;\n    constructor(sf, componentDefinitionPool) {\n        this.componentDefinitionPool = componentDefinitionPool;\n        this.sf = sf;\n    }\n    public async scanComponent(element): Promise<any> {\n        let compDef: ComponentDefinition = this.componentDefinitionPool[element.localName];\n        if (compDef) {\n            let attrs = element.attributes;\n            return this.generate(element, compDef, attrs);\n        } else {\n            if (element.children && element.children.length > 0) {\n                for (let i = 0; i < element.children.length; i++) {\n                    let child = element.children[i];\n                    await this.scanComponent(child);\n                }\n                return element;\n            } else {\n                return element;\n            }\n        }\n    }\n\n    private async generate(tagElement: HTMLElement, compDef: ComponentDefinition, attrs) {\n        this.dealWithShadowStyle(compDef);\n        let randomAlias = 'vm_' + Math.floor(10000 * Math.random()).toString();\n        let template = compDef.template;\n        template = template.replace(new RegExp('this', 'gm'), randomAlias);\n        let tempFragment = document.createElement('div');\n        tempFragment.insertAdjacentHTML('afterBegin' as InsertPosition, template);\n        if (tempFragment.children.length > 1) {\n            template = tempFragment.outerHTML;\n        }\n        tagElement.insertAdjacentHTML('beforeBegin' as InsertPosition, template);\n        let htmlDom = tagElement.previousElementSibling;\n        htmlDom.classList.add(tagElement.localName);\n        if (compDef.script) {\n            let ViewModelClass: Function = new Function(compDef.script);\n            this.sf.registerViewModel(randomAlias, new ViewModelClass.prototype.constructor());\n\n        } else {\n            for (let i = 0; i < attrs.length; i++) {\n                let attr = attrs[i];\n                htmlDom.setAttribute(attr.nodeName, attr.nodeValue);\n            }\n        }\n\n        tagElement.parentNode.removeChild(tagElement);\n        if (htmlDom.children && htmlDom.children.length > 0) {\n            for (let j = 0; j < htmlDom.children.length; j++) {\n                let child = htmlDom.children[j];\n                await this.scanComponent(child);\n            }\n            return htmlDom;\n        } else {\n            return htmlDom;\n        }\n    }\n\n\n\n    private dealWithShadowStyle(compDef:ComponentDefinition): void {\n        let stylesheet = compDef.style;\n        let tagName = compDef.tagName;\n        let head = document.getElementsByTagName('HEAD')[0];\n        let style = document.createElement('style');\n        style.type = 'text/css';\n        var styleArray = stylesheet.split(\"}\");\n        var newArray = [];\n        styleArray.forEach((value: string, index: number) => {\n            var newValue = value.replace(/^\\s*/, \"\");\n            if (newValue) {\n                newArray.push(newValue);\n            }\n        });\n        stylesheet = newArray.join(\"}\\n\" + \".\" + tagName + \" \");\n        stylesheet = \".\" + tagName + \" \" + stylesheet + \"}\";\n        style.innerHTML = stylesheet;\n        head.appendChild(style);\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/component/ComponentGenerator.ts"],"sourceRoot":""}